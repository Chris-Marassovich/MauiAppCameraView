<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:pageModels="clr-namespace:MauiAppCameraView.PageModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:DataType="pageModels:CameraViewPageViewModel"
             x:Class="MauiAppCameraView.Pages.CameraViewPage"
             BackgroundColor="Black"
             Title="Capture Photo">
    <ContentPage.Resources>
        <ResourceDictionary>
            <toolkit:IsNotNullConverter x:Key="IsNotNullConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid toolkit:StateContainer.CurrentState="{Binding MainLayoutState}">
        <toolkit:StateContainer.StateViews>
            <Grid ColumnDefinitions="*"
                  RowDefinitions="*, Auto"
                  toolkit:StateView.StateKey="Preview">
                <ContentView Grid.Column="0"
                             Grid.Row="0"
                             BackgroundColor="#80CCCCCC">
                    <Image x:Name="image"
                           Source="{Binding ImageSource}"
                           VerticalOptions="Fill"
                           HorizontalOptions="Fill" />
                </ContentView>
                <Grid Grid.Column="0"
                      Grid.Row="2"
                      Margin="5"
                      ColumnDefinitions="*,*">
                    <Button Grid.Column="0"
                            Text="Retake"
                            Command="{Binding PreviewRetakeCommand}" />
                    <Button Grid.Column="1"
                            Text="Use Photo" />
                </Grid>
            </Grid>

            <Grid RowDefinitions="200,*,Auto,Auto"
                  ColumnDefinitions="*"
                  toolkit:StateView.StateKey="Capture">
                <Picker Title="Available Resolutions"
                        Grid.Column="0"
                        Grid.Row="0"
                        HorizontalOptions="Center"
                        VerticalOptions="Start"
                        TitleColor="DodgerBlue"
                        ItemsSource="{Binding SelectedCamera.SupportedResolutions, FallbackValue=''}"
                        SelectedItem="{Binding SelectedResolution}" />
                <toolkit:CameraView x:Name="Camera"
                                    Grid.Column="0"
                                    Grid.Row="0"
                                    Grid.RowSpan="3"
                                    CameraFlashMode="{Binding FlashMode}"
                                    ImageCaptureResolution="{Binding SelectedResolution}"
                                    SelectedCamera="{Binding SelectedCamera}" />
                <Grid Grid.Column="0"
                      Grid.Row="3"
                      BackgroundColor="Transparent">

                    <Grid Margin="5"
                          ColumnDefinitions="*,Auto,*">
                        <HorizontalStackLayout Margin="0,0,20,0"
                                               Grid.Column="0"
                                               VerticalOptions="Center"
                                               HorizontalOptions="End">
                            <Label Text="Flash:"
                                   VerticalOptions="Center"
                                   TextColor="DodgerBlue" />
                            <Picker Title="N/A"
                                    Margin="0,0,20,0"
                                    Grid.Column="0"
                                    TextColor="DodgerBlue"
                                    ItemsSource="{Binding FlashModes}"
                                    SelectedItem="{Binding FlashMode}" />
                        </HorizontalStackLayout>

                        <Button Command="{Binding CaptureImageCommand, Source={x:Reference Camera}, x:DataType=toolkit:CameraView}"
                                IsEnabled="{Binding SelectedCamera, Converter={StaticResource IsNotNullConverter}}"
                                Grid.Column="1"
                                CommandParameter="{Binding Token}"
                                Text="O"
                                TextColor="Black"
                                FontSize="Title"
                                FontAttributes="Bold"
                                BackgroundColor="DarkRed"
                                CornerRadius="25"
                                HeightRequest="50"
                                WidthRequest="50" />
                        <!--<Button Command="{Binding CapturePhotoCommand}"
                        Grid.Column="1"
                        Text="O"
                        TextColor="Black"
                        FontSize="Title"
                        FontAttributes="Bold"
                        BackgroundColor="DarkRed"
                        CornerRadius="25"
                        HeightRequest="50"
                        WidthRequest="50" />-->

                        <Picker Title="Cameras"
                                TitleColor="DodgerBlue"
                                Grid.Column="2"
                                HorizontalOptions="Start"
                                ItemsSource="{Binding Cameras}"
                                ItemDisplayBinding="{Binding Name}"
                                SelectedItem="{Binding SelectedCamera}" />
                    </Grid>
                </Grid>
            </Grid>
        </toolkit:StateContainer.StateViews>
    </Grid>
</ContentPage>